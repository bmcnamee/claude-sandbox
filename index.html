<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Slide Puzzle</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #080810;
      --accent: #00e5ff;
      --accent2: #ff2d6b;
      --grid-bg: #1a1a2e;
      --line: #2a2a4a;
      --glow: 0 0 18px #00e5ff, 0 0 36px #00e5ff55;
      --glow2: 0 0 18px #ff2d6b, 0 0 36px #ff2d6b55;
      --size: min(92vw, 480px);
      --tile: calc(var(--size) / 5);
    }

    body {
      background: var(--bg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Share Tech Mono', monospace;
      color: #fff;
      padding: 1rem;
      overflow: hidden;
    }

    body::after {
      content: '';
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.07) 2px, rgba(0,0,0,0.07) 4px);
      pointer-events: none;
      z-index: 999;
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: clamp(1.2rem, 5vw, 1.8rem);
      letter-spacing: 0.15em;
      margin-bottom: 0.25rem;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 0.6rem;
      letter-spacing: 0.3em;
      color: #444466;
      text-transform: uppercase;
      margin-bottom: 1.2rem;
    }

    /* Stats bar */
    .stats {
      display: flex;
      gap: 2.5rem;
      margin-bottom: 1rem;
      align-items: center;
    }

    .stat { text-align: center; }

    .stat-label {
      font-size: 0.5rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #444466;
      margin-bottom: 0.2rem;
    }

    .stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent);
      text-shadow: var(--glow);
      font-variant-numeric: tabular-nums;
      min-width: 4ch;
      display: inline-block;
      text-align: center;
    }

    /* Puzzle board */
    .board-wrap {
      position: relative;
      width: var(--size);
      height: var(--size);
      background: var(--line);
      border: 2px solid var(--line);
      border-radius: 4px;
      box-shadow: 0 0 60px rgba(0,0,0,0.9), 0 0 2px var(--accent);
      overflow: hidden;
    }

    .tile {
      position: absolute;
      width: var(--tile);
      height: var(--tile);
      background-size: calc(var(--size)) calc(var(--size));
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease;
      border: 1.5px solid rgba(0,229,255,0.12);
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .tile:hover:not(.empty) {
      box-shadow: inset 0 0 0 2px rgba(0,229,255,0.4);
      z-index: 2;
    }

    .tile.empty {
      background: var(--bg) !important;
      cursor: default;
      border-color: transparent;
    }

    .tile.sliding {
      transition: transform 0.12s ease;
      z-index: 3;
    }

    /* Win overlay */
    .win-overlay {
      position: absolute;
      inset: 0;
      background: rgba(8,8,16,0.88);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
      z-index: 10;
    }

    .win-overlay.show {
      opacity: 1;
      pointer-events: all;
    }

    .win-title {
      font-family: 'Orbitron', sans-serif;
      font-weight: 900;
      font-size: 1.6rem;
      color: var(--accent);
      text-shadow: var(--glow);
      letter-spacing: 0.1em;
    }

    .win-stats {
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      color: #888899;
      text-align: center;
      line-height: 1.8;
    }

    /* Status line */
    .status {
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #444466;
      margin-top: 0.8rem;
      height: 1rem;
    }

    /* Buttons */
    .buttons { display: flex; gap: 1rem; margin-top: 1.2rem; }

    .btn {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.6rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #888899;
      background: transparent;
      border: 1px solid #2a2a4a;
      padding: 0.6rem 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
    }

    .btn:hover, .btn:active { color: #fff; border-color: #555577; background: #12122a; }

    .btn.primary {
      color: var(--accent);
      border-color: var(--accent);
    }

    .btn.primary:hover, .btn.primary:active {
      background: rgba(0,229,255,0.1);
      box-shadow: var(--glow);
    }

    /* Loading state */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: var(--size);
      height: var(--size);
      background: var(--grid-bg);
      border: 2px solid var(--line);
      border-radius: 4px;
      gap: 1rem;
    }

    .loading-text {
      font-size: 0.65rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: #444466;
    }

    .loading-bar {
      width: 120px;
      height: 2px;
      background: var(--line);
      position: relative;
      overflow: hidden;
    }

    .loading-bar::after {
      content: '';
      position: absolute;
      left: -50%;
      top: 0;
      width: 50%;
      height: 100%;
      background: var(--accent);
      box-shadow: var(--glow);
      animation: scan 1s linear infinite;
    }

    @keyframes scan {
      from { left: -50%; }
      to   { left: 150%; }
    }

    .error-text {
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      color: var(--accent2);
      text-align: center;
      padding: 1rem;
      line-height: 1.8;
      max-width: 80%;
    }
  </style>
</head>
<body>

  <h1>Slide Puzzle</h1>
  <div class="subtitle">5 × 5 — Hard Mode</div>

  <div class="stats">
    <div class="stat">
      <div class="stat-label">Moves</div>
      <div class="stat-value" id="moves">0</div>
    </div>
    <div class="stat">
      <div class="stat-label">Time</div>
      <div class="stat-value" id="timer">0:00</div>
    </div>
  </div>

  <div id="board-container">
    <div class="loading" id="loading">
      <div class="loading-text">Loading puzzle.jpg…</div>
      <div class="loading-bar"></div>
    </div>
  </div>

  <div class="status" id="status"></div>

  <div class="buttons">
    <button class="btn primary" id="shuffle-btn" style="display:none">Shuffle</button>
    <button class="btn" id="reset-btn" style="display:none">Reset</button>
  </div>

  <script>
    const GRID = 5;
    const TOTAL = GRID * GRID;
    const EMPTY = TOTAL - 1; // index of empty tile (bottom-right when solved)

    let tiles = [];       // current positions: tiles[i] = which puzzle piece is at slot i
    let tileEls = [];     // DOM elements indexed by piece number
    let moves = 0;
    let timerInterval = null;
    let seconds = 0;
    let started = false;
    let solved = false;
    let imgSize = 0;

    const movesEl = document.getElementById('moves');
    const timerEl = document.getElementById('timer');
    const statusEl = document.getElementById('status');
    const shuffleBtn = document.getElementById('shuffle-btn');
    const resetBtn = document.getElementById('reset-btn');

    function formatTime(s) {
      const m = Math.floor(s / 60);
      const sec = s % 60;
      return m + ':' + String(sec).padStart(2, '0');
    }

    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        seconds++;
        timerEl.textContent = formatTime(seconds);
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
    }

    function resetTimer() {
      stopTimer();
      seconds = 0;
      timerEl.textContent = '0:00';
    }

    // Build the board DOM
    function buildBoard(imgUrl) {
      const container = document.getElementById('board-container');
      container.innerHTML = '';

      const wrap = document.createElement('div');
      wrap.className = 'board-wrap';
      wrap.id = 'board-wrap';
      container.appendChild(wrap);

      // Win overlay
      const overlay = document.createElement('div');
      overlay.className = 'win-overlay';
      overlay.id = 'win-overlay';
      overlay.innerHTML = `
        <div class="win-title">Solved!</div>
        <div class="win-stats" id="win-stats"></div>
      `;
      wrap.appendChild(overlay);

      // Solved state: tiles[i] = i
      tiles = Array.from({length: TOTAL}, (_, i) => i);
      tileEls = [];

      for (let piece = 0; piece < TOTAL; piece++) {
        const el = document.createElement('div');
        el.className = 'tile' + (piece === EMPTY ? ' empty' : '');
        if (piece !== EMPTY) {
          const px = (piece % GRID) * imgSize;
          const py = Math.floor(piece / GRID) * imgSize;
          el.style.backgroundImage = `url('${imgUrl}')`;
          el.style.backgroundPosition = `-${px}px -${py}px`;
        }
        el.addEventListener('click', () => onTileClick(piece));
        el.addEventListener('touchend', (e) => { e.preventDefault(); onTileClick(piece); });
        wrap.appendChild(el);
        tileEls.push(el);
      }

      positionAll();
      shuffleBtn.style.display = '';
      resetBtn.style.display = '';
      statusEl.textContent = 'Tap a tile next to the gap to move it';
    }

    // Position all tile DOM elements based on current tiles[] state
    function positionAll() {
      const tileSize = imgSize; // same as tile CSS size
      for (let slot = 0; slot < TOTAL; slot++) {
        const piece = tiles[slot];
        const el = tileEls[piece];
        const col = slot % GRID;
        const row = Math.floor(slot / GRID);
        el.style.transform = `translate(${col * tileSize}px, ${row * tileSize}px)`;
      }
    }

    // Find slot of a piece
    function slotOf(piece) {
      return tiles.indexOf(piece);
    }

    // Find slot of empty
    function emptySlot() {
      return slotOf(EMPTY);
    }

    // Get adjacent slots to empty that can move
    function movableSlots() {
      const es = emptySlot();
      const eCol = es % GRID;
      const eRow = Math.floor(es / GRID);
      const adj = [];
      if (eCol > 0) adj.push(es - 1);
      if (eCol < GRID - 1) adj.push(es + 1);
      if (eRow > 0) adj.push(es - GRID);
      if (eRow < GRID - 1) adj.push(es + GRID);
      return adj;
    }

    function onTileClick(piece) {
      if (solved) return;
      if (piece === EMPTY) return;

      const pieceSlot = slotOf(piece);
      const es = emptySlot();

      // Check if adjacent
      const movable = movableSlots();
      if (!movable.includes(pieceSlot)) return;

      // Swap
      tiles[es] = piece;
      tiles[pieceSlot] = EMPTY;
      positionAll();

      if (!started) {
        started = true;
        startTimer();
        statusEl.textContent = '';
      }

      moves++;
      movesEl.textContent = moves;

      if (checkSolved()) {
        stopTimer();
        solved = true;
        statusEl.textContent = '';
        document.getElementById('win-stats').innerHTML =
          `Moves: ${moves}<br>Time: ${formatTime(seconds)}`;
        setTimeout(() => {
          document.getElementById('win-overlay').classList.add('show');
        }, 300);
      }
    }

    function checkSolved() {
      for (let i = 0; i < TOTAL; i++) {
        if (tiles[i] !== i) return false;
      }
      return true;
    }

    // Fisher-Yates shuffle that guarantees solvability
    function shuffle() {
      // Reset first
      tiles = Array.from({length: TOTAL}, (_, i) => i);

      // Do random valid moves (guarantees solvability)
      let lastEmpty = -1;
      for (let i = 0; i < 500; i++) {
        const movable = movableSlots().filter(s => s !== lastEmpty);
        const pick = movable[Math.floor(Math.random() * movable.length)];
        const es = emptySlot();
        lastEmpty = es;
        tiles[es] = tiles[pick];
        tiles[pick] = EMPTY;
      }

      positionAll();
      moves = 0;
      movesEl.textContent = '0';
      resetTimer();
      started = false;
      solved = false;
      document.getElementById('win-overlay').classList.remove('show');
      statusEl.textContent = 'Tap a tile next to the gap to move it';
    }

    shuffleBtn.addEventListener('click', shuffle);
    resetBtn.addEventListener('click', () => {
      tiles = Array.from({length: TOTAL}, (_, i) => i);
      positionAll();
      moves = 0;
      movesEl.textContent = '0';
      resetTimer();
      started = false;
      solved = false;
      document.getElementById('win-overlay').classList.remove('show');
      statusEl.textContent = 'Tap a tile next to the gap to move it';
    });

    // Load image
    function init() {
      const cssSize = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--size'));
      // Compute pixel size from CSS var
      const dummy = document.createElement('div');
      dummy.style.width = 'min(92vw, 480px)';
      dummy.style.position = 'absolute';
      dummy.style.visibility = 'hidden';
      document.body.appendChild(dummy);
      imgSize = dummy.offsetWidth / GRID;
      document.body.removeChild(dummy);

      // Also set the CSS variable for tile size
      document.documentElement.style.setProperty('--tile', imgSize + 'px');
      document.documentElement.style.setProperty('--size', (imgSize * GRID) + 'px');

      const img = new Image();
      img.onload = () => {
        buildBoard('puzzle.jpg');
        shuffle();
      };
      img.onerror = () => {
        const container = document.getElementById('board-container');
        container.innerHTML = `
          <div class="loading">
            <div class="error-text">
              Could not load puzzle.jpg<br><br>
              Upload a file named <strong>puzzle.jpg</strong><br>
              to your GitHub repo alongside<br>
              this index.html file.
            </div>
          </div>`;
      };
      img.src = 'puzzle.jpg';
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>
